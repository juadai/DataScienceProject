---
title: "Understorey_modelling"
author: "Juan Dai"
date: "2022-08-22"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("~/Desktop/capstone/analysis/Juan/Understorey_priority2&low")

df = read.csv("understorey_output.csv")

```

In conclusion, the absolute value of each variable fit the model better, especially the guassian model, and both treatment are statistically significant, but the gap shows a positive effect and radial shows a negative effect, and the plots from the radial give a positive and statistically significant coefficient, which contradicts with the treatment coefficient. beside, the change_rate variable always yields the lowest AIC values among all three dependent variables. The model selection procedures states that the plot number are the only significant variables in predicting the diversity, richness and relative abundance.

## Diversity
The abs_diversity fit the guassian model states that the treatment Gap has positive effect on abs_diveristy, that is the Gap treatment will increase the species diversity while Radial treatment has a negative effect. However, the radial treatment plots tend to have positive and statistically significant coefficient, which contradict with the treatment coefficient, then we try to exclude the plot number, then all the coefficients become insignificant. we then tried the model selection, all the variable selected are plot number, which indicates that the plot number are the true factor affect the diversity.
```{r guassian_abs_diversity, echo = TRUE}
# model using gaussian
model = glm(abs_diversity ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = gaussian, data = df)
summary(model)
par(mfrow = c(2,2))

plot(model)

```


```{r guassian_abs_diversity(removed_plot_num), echo = TRUE}
# model using gaussian
model_rm = glm(abs_diversity ~ Treatment  + as.factor(Quadrat_number), family = gaussian, data = df)
summary(model_rm)
par(mfrow = c(2,2))

plot(model_rm)
```


```{r guassian_relative_diversity, echo = TRUE}
# model using gaussian
model1 = glm(diversity_change_rate ~ Treatment + as.factor(Plot_number) + as.factor(Quadrat_number), family = gaussian, data = df)
summary(model1)
par(mfrow = c(2,2))

plot(model1)
```
The diverity change rate has the lowest AIC value, but it does not fit guassian model well.

The absolute diversity change fit the normal distribution better as all the diagnosis plots state.
Then we will use the AIC to find some significant variable:
```{r guassian_AIC_select, echo = TRUE}
# model using gaussian
model = glm(abs_diversity ~ Treatment + as.factor(Plot_number) + as.factor(Quadrat_number), family = gaussian, data = df)
model_selected2 <-step(model, scope=~.)
summary(model_selected2)

par(mfrow = c(2,2))
plot(model_selected2)
```

```{r gamma_relative_diversity, echo = TRUE}
# model using gamma with inverse link function
model2 = glm(relative_diversity~ Treatment + as.factor(Plot_number) + as.factor(Quadrat_number), family = Gamma(link = "inverse"), data = df)
summary(model2)
par(mfrow = c(2,2))
plot(model2)

# model using gamma with inverse link function
model3 = glm(abs_diversity + (-min(abs_diversity) + 1)~ Treatment + as.factor(Plot_number) + as.factor(Quadrat_number), family = Gamma(link = "inverse"), data = df)
summary(model3)
par(mfrow = c(2,2))
plot(model3)
```

```{r gamma_abs_diversity, echo = TRUE}
# model using gamma with log link function
model4 = glm(abs_diversity + (-min(abs_diversity) + 1)~ Treatment + as.factor(Plot_number) + as.factor(Quadrat_number), family = Gamma(link = "log"), data = df)
summary(model4)
par(mfrow = c(2,2))
plot(model4)
```

```{r gamma_diversity_change_rate, echo = TRUE}
# model using gamma with log link function
model5 = glm(diversity_change_rate + (-min(abs_diversity) + 1)~ Treatment + as.factor(Plot_number) + as.factor(Quadrat_number), family = Gamma(link = "log"), data = df)
summary(model5)
par(mfrow = c(2,2))
plot(model5)
```

The absolute diversity change fit the gamma distribution better as all the diagnosis plots state.
Then we will use the AIC to find some significant variable:
```{r guassian_AIC_select, echo = TRUE}
# model using gaussian
model_selected4 <-step(model4, scope=~.)
summary(model_selected4)

par(mfrow = c(2,2))
plot(model_selected4)
```
According to the AIC, the guassian model with abs_diversity performs better, it has the lowest AIC value of 1617.2


```{r poisson_abs_diversity, echo = TRUE}
# model using poisson 
model6 = glm(abs_diversity + (-min(abs_diversity) + 1)~ Treatment + as.factor(Plot_number) + as.factor(Quadrat_number), family = poisson, data = df)
summary(model6)
par(mfrow = c(2,2))
plot(model6)
```

```{r poisson_relaitve_diversity, echo = TRUE}
# model using poisson + log link
model7 = glm(relative_diversity + (-min(abs_diversity) + 1)~ Treatment + as.factor(Plot_number) + as.factor(Quadrat_number), family = poisson(link = "log"), data = df)
summary(model7)
par(mfrow = c(2,2))
plot(model7)
```

```{r poisson_diversity_change_rate, echo = TRUE}
# model using poisson + log link
model8 = glm(diversity_change_rate + (-min(abs_diversity) + 1)~ Treatment + as.factor(Plot_number) + as.factor(Quadrat_number), family = poisson(link = "log"), data = df)
summary(model8)
par(mfrow = c(2,2))
plot(model8)
```
abs_diversity always fits the model better, so choose the abs_diversity as the variable to fit models


##Richness
The richness shows the same trend as the diversity, both gap and radial are statistically significant, but the gap has positive effect on the absolute richness, while the radial has negative effect on the richness. When the radial treatment coef is negative, the plots from radial treatment shows a positive and statistically significant coefficient. The abs_richness fit the model better than both relative richness and richness change rate. But the richness change rate has lowest AIC.
```{r guassian_abs_richness, echo = TRUE}
# model using gaussian
modelr = glm(abs_richness ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = gaussian, data = df)
summary(modelr)
par(mfrow = c(2,2))

plot(modelr)

```

```{r guassian_relative_richness, echo = TRUE}
# model using gaussian
modelr1 = glm(relative_richness ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = gaussian, data = df)
summary(modelr1)
par(mfrow = c(2,2))

plot(modelr1)

```

```{r guassian_richness_change_rate, echo = TRUE}
# model using gaussian
modelr2 = glm(richness_change_rate ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = gaussian, data = df)
summary(modelr2)
par(mfrow = c(2,2))

plot(modelr2)
```
```{r guassian_AIC_select_richness, echo = TRUE}
# model using gaussian
modelr_selected2 <-step(modelr, scope=~.)
summary(modelr_selected2)

par(mfrow = c(2,2))
plot(modelr_selected2)
```


```{r gamma_abs_richness+inverse_link, echo = TRUE}
# model using gamma+ inverse link
modelr3 = glm(abs_richness + (-min(abs_richness) + 1) ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = Gamma(link = "inverse"), data = df)
summary(modelr3)
par(mfrow = c(2,2))

plot(modelr3)

```

```{r gamma_relative_richness+inverse_link, echo = TRUE}
# model using gamma + inverse link
modelr4 = glm(relative_richness + (-min(abs_richness) + 1) ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = Gamma(link = "inverse"), data = df)
summary(modelr4)
par(mfrow = c(2,2))

plot(modelr4)
```
```{r poisson_AIC_select_richness, echo = TRUE}
# model using gamma + inverse link + abs_richness
modelr_selected3 <-step(modelr3, scope=~.)
summary(modelr_selected3)

par(mfrow = c(2,2))
plot(modelr_selected3)
```

```{r poisson_abs_richness+inverse_link, echo = TRUE}
# model using gamma+ inverse link
modelr5 = glm(abs_richness + (-min(abs_richness) + 1) ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = poisson, data = df)
summary(modelr5)
par(mfrow = c(2,2))

plot(modelr5)

```

```{r quasi-poisson_abs_richness+inverse_link, echo = TRUE}
# model using gamma+ inverse link
modelr6 = glm(abs_richness + (-min(abs_richness) + 1) ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = quasipoisson, data = df)
summary(modelr6)
par(mfrow = c(2,2))

plot(modelr6)

```
## relative abundances
The relative abundances of species has the same trend as diversity and richness
```{r guassian_abs_relative_abundance, echo = TRUE}
# model using gaussian
modelra = glm(abs_relative_abundance ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = gaussian, data = df)
summary(modelra)
par(mfrow = c(2,2))

plot(modelra)

```

```{r guassian_relative_abundance, echo = TRUE}
# model using gaussian
modelra1 = glm(relative_abundance ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = gaussian, data = df)
summary(modelra1)
par(mfrow = c(2,2))

plot(modelra1)

```

```{r guassian_relative_abundance_change_rate, echo = TRUE}
# model using gaussian
modelra2 = glm(relative_abundance_change_rate ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = gaussian, data = df)
summary(modelra2)
par(mfrow = c(2,2))

plot(modelra2)

```

```{r guassian_AIC_select_relative_abundance, echo = TRUE}
# model using gaussian
modelra_selected2 <-step(modelra, scope=~.)
summary(modelr_selected2)

par(mfrow = c(2,2))
plot(modelra_selected2)
```

```{r gamma_abs_relative_abundance+inverse, echo = TRUE}
# model using gamma + inverse
modelra3 = glm(abs_relative_abundance + (-min(abs_relative_abundance) + 1) ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = Gamma(link = "inverse"), data = df)
summary(modelra3)
par(mfrow = c(2,2))

plot(modelra3)

```

```{r ggamma_abs_relative_abundance+log, echo = TRUE}
# model using gamma + log link
modelra4 = glm(abs_relative_abundance + (-min(abs_relative_abundance) + 1) ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = Gamma(link = "log"), data = df)
summary(modelra4)
par(mfrow = c(2,2))

plot(modelra4)
```

```{r poisson_abs_relative_abundance, echo = TRUE}
# model using gamma + inverse
modelra5 = glm(abs_relative_abundance + (-min(abs_relative_abundance) + 1) ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = poisson, data = df)
summary(modelra5)
par(mfrow = c(2,2))

plot(modelra5)
```

```{r quasi-poisson_abs_relative_abundance, echo = TRUE}
# model using gamma + inverse
modelra6 = glm(abs_relative_abundance + (-min(abs_relative_abundance) + 1) ~ Treatment  + as.factor(Plot_number) +as.factor(Quadrat_number), family = quasipoisson, data = df)
summary(modelra6)
par(mfrow = c(2,2))

plot(modelra6)
```
