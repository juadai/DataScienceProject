---
title: "model_analysis"
output: word_document
date: "2022-08-18"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("~/Desktop/capstone/analysis/Juan")

CWDdata = read.csv("output.csv")
```


## Gussian model fitting

The scale-location plot shows an increasing trend, it states the heteroskedasticity, that is the spread of the residuals is not equal, and the cookâ€™s distance shows that the point 3 are a significant influential point. All 3, 5, 9 are outliers, and all of them are from treatment Radial. All the coefficient is not significant in this case, so even though all of them are positive, we cannot draw conclusion from it.
```{r guassian_identity, echo = TRUE}
# model using gaussian
model = glm(difference ~ treatment, family = gaussian, data = CWDdata)
summary(model)

par(mfrow = c(2,2))
plot(model)
```

create data:
(1)removal of plot 3; 
(2)removal of plot 6; 
(3)adding a constant.
```{r data_redefinition, echo=FALSE}
CWDdata = CWDdata[-c(12),]
CWDdatarm3 = CWDdata[-c(3),]
CWDdatarm6 = CWDdata[-c(6),]
CWDdata["abs_diff"] = CWDdata["difference"] + abs(min(CWDdata["difference"])) + 1
```


Then we tried to **remove the plot 3(most significant outlier) and plot 12**, the outstanding outliers become 7,8,9, both 7 and 9 are influential points, besides, QQplot and scale location plots state that violation of the model assumption, even though the Gap treatment and radial treatment become significant now, and AIC is smaller than before.
```{r guassian_remove_plot3, echo=FALSE}
#guassian model + plot3 removed

modelrm = glm(difference ~ treatment , family = gaussian, data = CWDdatarm3)
summary(modelrm)

par(mfrow = c(2,2))
plot(modelrm)
# the plot here shows that the plot 3, 5, 9 are always outliers, but all of 
# them are from the radial treatment
```



## Poisson model fitting

The poisson model cannot be used directly, since the one of the difference in CWD is -6.5, so if we want to fit the poisson model, we have to convert all different to positive by adding a constant in r.(pros: no information is lost + we only care the direction rather than the magnitude) this time the scale-location model still shows an increasing trend, all 3,5, 9 becomes significant influential this time, almost all points become influential. So, this fitting is worse than the original guassian model fitting. All the coefficient is statistically significant and positive.
```{r poisson_abs_diff, echo=FALSE}
# model using poisson + abs_diff
model0 = glm(abs_diff ~ treatment, family = poisson, data = CWDdata)
summary(model0)

par(mfrow = c(2,2))
plot(model0)

```


Then we tried to remove the only negative value, it does not make much difference compared to the absolute value transformation (magnitude is smaller than before for both treatment), but all the coefs becomes statistically significant.
```{r poisson_remove_plot6, echo=FALSE}
# model using poisson + difference
model1 = glm(difference ~ treatment, family = poisson, data = CWDdatarm6)
summary(model1)

par(mfrow = c(2,2))
plot(model1)
```


## Quasi-poisson model fitting

The quansi-poisson cannot be used directly, we use adding a constant to further fit into the quasi-poisson model to resolve the overdispersion problem, the scale-location still shows an increasing trend, the outlier this time is point 3,5,9, and all of them are from the treatment Radial. Plot 3 is the only influential point. But all the coefficients are not significant but are positive. 
```{r quasi_poisson, echo=FALSE}
## quasipoisson + diff
model2 = glm(abs_diff ~ treatment, family = quasipoisson, data = CWDdata)
summary(model2)

par(mfrow = c(2,2))
plot(model2)
```



## Gamma model fitting

The Gamma also takes no negative values, we first fit the inverse link function, the outliers are 3(Radial), 6(C),11(C), and no significant points are presented, but the normal QQ plot is left-skewed, and the scale-location is showed a decreasing trend first and then increasing trend. All the coefficients from the model are positive but not statistically significant. But the AIC is the lowest among all the models.
```{r gamma_diff_inverse, echo=FALSE}
## Gamma + abs_diff + inverse
model3 = glm(abs_diff ~ treatment, family = Gamma(link = "inverse"), data = CWDdata)
summary(model3)

par(mfrow = c(2,2))
plot(model3)
```


Since the model has lowest AIC with the maximum information we can remained, so we further fit the log link function for it. This time the outlier become 3,6,11, all three coefs are statistically significant at 95% significance level but some violation about the model assumption.
```{r gamma_diff_log, echo=FALSE}
## Gamma + abs_diff + log
model5 = glm(abs_diff ~ treatment, family = Gamma(link = "log"), data = CWDdata)
summary(model5)

par(mfrow = c(2,2))
plot(model5)
```